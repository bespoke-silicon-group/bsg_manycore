SPMD Directory
==============

Manycore regression
-------------------

RTL regression testing of the manycore.

`make [bsg_tiles_X=<x>] [bsg_tiles_Y=<y>] [COVERAGE=VCS]` 

- `bsg_tiles_X`:
    Can be used to specify the number of rows to be instantiated. Default
    value provided in individual testcases.
- `bsg_tiles_Y`:
    Can be used to specify the number of columns to be instantiated. Default
    value provided in individual testcases.
- `COVERAGE=VCS`:
    RTL Coverage analysis using VCS. Coverage reports generated using
    Unified Coverage Genrator (URG). Default configuration used for
    the coverage analysis is 4x4. This will be overwritten only when
    above dimension variables are explicitly set.
- `ENABLE_VCACHE = {0|1}`:
    include vcache or instead include block SRAM.

Note: 
    Current design is only tested for x<=4, y<=4 and dimensions mentioned in
    individual testcases.


`common/`
----------

Common resources used by all SPMD programs.

- `common/crt.S`:
  - C runtime code for BSG Manycore.
  - Intializes stack pointer `sp`, thread pointer `tp` and global pointer `gp`.
  - Initializes rest of the general purpose registers to `0`.
  - Calls `main` function.
  - **Doesn't call a exit routine! SPMD programs should call `bsg_finish()` to exit.**

- `common/link_dmem.ld`:
  - Link script for programs in which data & stack can fit in DMEM.
  - Places all data sections in DMEM, `.dram` section and text sections in DRAM.
  - `sp` is initialized to the end of DMEM -- `0x1ffc`.
  - Data can be placed in DRAM by explcitly attributing it to `.dram` section.
  - **Default link script for programs in this directory.**

- `common/link_dram.ld`:
  - Link script to run larger programs.
  - Places `.dmem` and sections in `bsg_manycore_lib.a` in DMEM and all other sections in DRAM.
  - `sp` is initialized to the end of DRAM -- `0xfffffffc`.

- ELF binaries generated by manycore's link scripts follows memory layout described [here](
https://docs.google.com/document/d/1b2g2nnMYidMkcn6iHJ9NGjpQYfZeWEmMdLeO_3nLtgo/edit#bookmark=id.6ta2llhb2shf).
  
- Special sybmols defined in manycore's link scripts:
  - `_bsg_data_start_addr`: Begin NPA of DMEM data segment.
  - `_bsg_data_end_addr`: End NPA of DMEM data segment.
  - `_bsg_dram_t_start_addr`: Begin NPA of DRAM text segment.
  - `_bsg_dram_t_end_addr`: End NPA of DRAM text segment.
  - `_bsg_dram_d_start_addr`: Begin NPA of DRAM data segment.
  - `_bsg_dram_d_end_addr`: End NPA of DRAM data segment.
  - `_bsg_dram_end_addr`: Heap pointer.
  - `_sp`: Initial stack pointer. `crt.S` uses this symbol to initialize `sp`.
  - `_gp`: Global pointer. `crt.S` uses this symbol to initialize `gp`.
